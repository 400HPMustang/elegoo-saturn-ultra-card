type: custom:auto-entities
unique: true
show_empty: false
card:
  type: custom:layout-card
  layout_type: masonry
card_param: cards
filter:
  template: >
    {%- set entities = integration_entities('elegoo_printer') -%} {%- set
    devices  = entities | map('device_id') | list -%} {%- set zip_list =
    zip(entities, devices) | list -%} [ {%- for d in (zip_list |
    map(attribute=1) | unique | list) -%}
      {%- set anchor = zip_list
            | selectattr(1,'eq', d)
            | selectattr(0,'search','_current_status$')
            | map(attribute=0) | list | first -%}
      {%- if not anchor -%}
        {%- set anchor = zip_list
              | selectattr(1,'eq', d)
              | selectattr(0,'search','_print_status$')
              | map(attribute=0) | list | first -%}
      {%- endif -%}
      {%- if not anchor %}{% continue %}{% endif -%}
      {%- set base = anchor.split('.')[1]
                      .replace('_current_status','')
                      .replace('_print_status','') -%}
      {# ---- Reusable white "glow" shadow ---- #}
      {%- set glow = '0 0 2px rgba(0,0,0,0.95), 0 0 8px rgba(255,255,255,0.95), 0 0 16px rgba(255,255,255,0.8)' -%}
      {{ {
        'type': 'picture-elements',
        'image': '/local/saturn_4_ultra.png',
        'aspect_ratio': '1/1.4',
        'elements': [

          { 'type':'custom:hui-element',
            'card_type':'custom:button-card',
            'entity':'sensor.' ~ base ~ '_uv_led_temp',
            'name':'UV Temp',
            'show_icon': false,
            'show_name': true,
            'show_state': true,
            'layout': 'vertical',
            'tap_action': { 'action':'more-info' },
            'style': {
              'top':'12%',
              'left':'50%',
              'transform':'translate(-50%,-50%)'
            },
            'styles': {
              'card': [
                { 'width': '64px' },
                { 'height': '64px' },
                { 'border-radius': '50%' },
                { 'background': 'rgba(0,0,0,0.35)' },
                { 'box-shadow': '0 2px 10px rgba(0,0,0,0.4)' },
                { 'padding': '6px 0 4px 0' }
              ],
              'name': [
                { 'font-size': '10px' },
                { 'line-height': '12px' },
                { 'color': 'white' },
                { 'text-shadow': glow }
              ],
              'state': [
                { 'font-size': '14px' },
                { 'font-weight': '700' },
                { 'line-height': '18px' },
                { 'color': 'white' },
                { 'text-shadow': glow }
              ]
            }
          },

          { 'type':'state-label',
            'entity':'sensor.' ~ base ~ '_current_status',
            'style': {
              'top':'69%','left':'68%','font-weight':'700','font-size':'14px',
              'color':'white','text-shadow': glow,
              'transform':'translate(-50%,-50%)'
            } },

          { 'type':'state-label',
            'entity':'sensor.' ~ base ~ '_percent_complete',
            'style': {
              'top':'78%','left':'63%','font-size':'16px','font-weight':'600',
              'color':'white','text-shadow': glow,
              'transform':'translate(-50%,-50%)'
            } },

          { 'type':'state-label',
            'entity':'sensor.' ~ base ~ '_remaining_print_time',
            'style': {
              'top':'78%','left':'73%','font-size':'16px','font-weight':'600',
              'color':'white','text-shadow': glow,
              'transform':'translate(-50%,-50%)'
            } },

          { 'type':'custom:hui-element',
            'card_type':'picture-entity',
            'entity':'camera.' ~ base ~ '_chamber_camera',
            'show_name': false, 'show_state': false, 'camera_view':'auto',
            'style': {
              'top':'48%','left':'50%','width':'54%','border-radius':'12px',
              'overflow':'hidden','box-shadow':'0 6px 18px rgba(0,0,0,0.35)'
            } },

          { 'type':'state-label',
            'entity':'sensor.' ~ base ~ '_current_layer',
            'prefix':'Layer: ',
            'style': {
              'top':'70%','left':'28%','transform':'none','font-size':'14px',
              'font-weight':'600','color':'white',
              'text-shadow': glow,'white-space':'nowrap'
            } },

          { 'type':'state-label',
            'entity':'sensor.' ~ base ~ '_total_layers',
            'prefix':'Total: ',
            'style': {
              'top':'76%','left':'28%','transform':'none','font-size':'14px',
              'font-weight':'600','color':'white',
              'text-shadow': glow,'white-space':'nowrap'
            } },

          { 'type':'conditional',
            'conditions': [
              { 'entity':'sensor.' ~ base ~ '_file_name', 'state_not':'unavailable' },
              { 'entity':'sensor.' ~ base ~ '_file_name', 'state_not':'unknown' },
              { 'entity':'sensor.' ~ base ~ '_file_name', 'state_not':'' }
            ],
            'elements': [
              { 'type':'state-label',
                'entity':'sensor.' ~ base ~ '_file_name',
                'content': '[[[ const s = hass.states["sensor.' ~ base ~ '_file_name"]?.state || ""; const name = s.split(/[\\/]/).pop().replace(/\.[^.]+$/,""); return name; ]]]',
                'style': {
                  'top':'30%','left':'50%','transform':'translate(-50%,-50%)',
                  'width':'72%','max-width':'72%','text-align':'center',
                  'white-space':'nowrap','overflow':'hidden','text-overflow':'ellipsis',
                  'font-size':'14px','font-weight':'700','color':'white',
                  'text-shadow': glow
                }
              }
            ]
          },

          { 'type':'conditional',
            'conditions': [
              { 'entity':'sensor.' ~ base ~ '_print_status', 'state_not':'idle' },
              { 'entity':'sensor.' ~ base ~ '_print_status', 'state_not':'complete' },
              { 'entity':'sensor.' ~ base ~ '_print_status', 'state_not':'stopped' },
              { 'entity':'sensor.' ~ base ~ '_print_status', 'state_not':'paused' }
            ],
            'elements': [
              { 'type':'icon', 'icon':'mdi:pause',
                'tap_action': {
                  'action':'call-service','service':'button.press',
                  'data': { 'entity_id':'button.' ~ base ~ '_pause_print' }
                },
                'style': { 'top':'93%','left':'42%','--mdc-icon-size':'26px' } },
              { 'type':'icon', 'icon':'mdi:stop',
                'tap_action': {
                  'action':'call-service','service':'button.press',
                  'data': { 'entity_id':'button.' ~ base ~ '_stop_print' }
                },
                'style': { 'top':'93%','left':'62%','--mdc-icon-size':'26px' } }
            ] },

          { 'type':'conditional',
            'conditions': [
              { 'entity':'sensor.' ~ base ~ '_file_name', 'state_not':'unavailable' },
              { 'entity':'sensor.' ~ base ~ '_file_name', 'state_not':'unknown' },
              { 'entity':'sensor.' ~ base ~ '_file_name', 'state_not':'' }
            ],
            'elements': [
              { 'type':'state-label',
                'entity':'sensor.' ~ base ~ '_file_name',
                'content': '[[[ const s = hass.states["sensor.' ~ base ~ '_file_name"]?.state || ""; const name = s.split(/[\\/]/).pop().replace(/\.[^.]+$/,""); return name; ]]]',
                'style': {
                  'top':'30%','left':'50%','transform':'translate(-50%,-50%)',
                  'width':'72%','max-width':'72%','text-align':'center',
                  'white-space':'nowrap','overflow':'hidden','text-overflow':'ellipsis',
                  'font-size':'14px','font-weight':'700','color':'white',
                  'text-shadow': glow
                }
              }
            ]
          },

          { 'type':'conditional',
            'conditions': [ { 'entity':'sensor.' ~ base ~ '_print_status', 'state':'paused' } ],
            'elements': [
              { 'type':'icon', 'icon':'mdi:play',
                'tap_action': {
                  'action':'call-service','service':'button.press',
                  'data': { 'entity_id':'button.' ~ base ~ '_resume_print' }
                },
                'style': { 'top':'93%','left':'52%','--mdc-icon-size':'26px' } },
              { 'type':'icon', 'icon':'mdi:stop',
                'tap_action': {
                  'action':'call-service','service':'button.press',
                  'data': { 'entity_id':'button.' ~ base ~ '_stop_print' }
                },
                'style': { 'top':'93%','left':'62%','--mdc-icon-size':'26px' } }
            ] },

          { 'type':'conditional',
            'conditions': [ { 'entity':'sensor.' ~ base ~ '_print_status', 'state':'idle' } ],
            'elements': [
              { 'type':'icon', 'icon':'mdi:pause',
                'style': {
                  'top':'93%','left':'42%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } },
              { 'type':'icon', 'icon':'mdi:play',
                'style': {
                  'top':'93%','left':'52%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } },
              { 'type':'icon', 'icon':'mdi:stop',
                'style': {
                  'top':'93%','left':'62%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } }
            ] },

          { 'type':'conditional',
            'conditions': [ { 'entity':'sensor.' ~ base ~ '_print_status', 'state':'complete' } ],
            'elements': [
              { 'type':'icon', 'icon':'mdi:pause',
                'style': {
                  'top':'93%','left':'42%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } },
              { 'type':'icon', 'icon':'mdi:play',
                'style': {
                  'top':'93%','left':'52%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } },
              { 'type':'icon', 'icon':'mdi:stop',
                'style': {
                  'top':'93%','left':'62%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } }
            ] },

          { 'type':'conditional',
            'conditions': [
              { 'entity':'sensor.' ~ base ~ '_error_status_reason', 'state_not':'ok' },
              { 'entity':'sensor.' ~ base ~ '_error_status_reason', 'state_not':'unavailable' }
            ],
            'elements': [
              { 'type':'state-label', 'entity':'sensor.' ~ base ~ '_error_status_reason',
                'style': {
                  'top':'60%','left':'50%','transform':'translate(-50%,-50%)',
                  'font-size':'14px','font-weight':'700','color':'#ffd9d9',
                  'text-shadow':'0 0 8px rgba(0,0,0,0.95)'
                } }
            ] },

          { 'type':'conditional',
            'conditions': [ { 'entity':'sensor.' ~ base ~ '_print_status', 'state':'stopped' } ],
            'elements': [
              { 'type':'icon', 'icon':'mdi:pause',
                'style': {
                  'top':'93%','left':'42%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } },
              { 'type':'icon', 'icon':'mdi:play',
                'style': {
                  'top':'93%','left':'52%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } },
              { 'type':'icon', 'icon':'mdi:stop',
                'style': {
                  'top':'93%','left':'62%','--mdc-icon-size':'28px',
                  'opacity':'0.5','color':'white',
                  'filter':'drop-shadow(0 2px 4px rgba(0,0,0,0.6))',
                  'pointer-events':'none'
                } }
            ] }
        ]
      } }}
      {{ "," if not loop.last else "" }}
    {%- endfor -%} ]
grid_options:
  columns: full
  rows: 1
